{% extends "inventory/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h1>Business Dashboard</h1>
        <h2>Overall Financials ({{ tax_year_start|date:"d M Y" }} - {{ tax_year_end|date:"d M Y" }})</h2>
    <div class="stat-card-container">
        <div class="stat-card">
            <div class="stat-card-label">Avg. Profit Per Pen</div>
            <div class="stat-card-value">£{{ avg_profit_per_pen|floatformat:2 }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-label">Current Stock Value</div>
            <div class="stat-card-value">£{{ current_stock_value|floatformat:2 }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-label">Total Expenses</div>
            <div class="stat-card-value">£{{ total_expenses|floatformat:2 }}</div>
        </div>

        <div class="stat-card">
            <div class="stat-card-label">Total Revenue</div>
            <div class="stat-card-value">£{{ sales_revenue|floatformat:2 }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-label">Gross Profit</div>
            <div class="stat-card-value">£{{ gross_profit|floatformat:2 }}</div>
        </div>
        <div class="stat-card {{ net_profit_class }}">
            <div class="stat-card-label">Net Profit</div>
            <div class="stat-card-value">£{{ net_profit|floatformat:2 }}</div>
        </div>
    </div>
    <div class="detail-section">
            <h2>Performance This Tax Year</h2>
            <canvas id="cumulativeChart"></canvas>
        </div>

        <script>
            const ctx = document.getElementById('cumulativeChart').getContext('2d');
            
            const chartLabels = {{ chart_labels|safe }};
            const revenueData = {{ cumulative_revenue_data|safe }};
            const profitData = {{ cumulative_profit_data|safe }};

            const cumulativeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Cumulative Revenue',
                        data: revenueData,
                        borderColor: 'rgb(0, 123, 255)',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        fill: true,
                        tension: 0.1
                    }, {
                        label: 'Cumulative Net Profit',
                        data: profitData,
                        borderColor: 'rgb(40, 167, 69)',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    return '£' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        </script>
{% endblock %}